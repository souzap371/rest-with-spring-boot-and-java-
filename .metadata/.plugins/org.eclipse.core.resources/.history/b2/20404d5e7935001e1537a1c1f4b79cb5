package br.ufrn.imd.solicitacaurn.solus.repository;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import br.com.mkapi.solus.domain.Pedido;

public interface PedidoRepository extends JpaRepository<Pedido, Long> {
	
	@Query(value = "SELECT * FROM (\r\n"
			+ "  SELECT row_number() OVER (ORDER BY tp.DT_PEDIDO DESC) linha, tp.* FROM TAB_PEDIDO tp \r\n"
			+ "  WHERE tp.CHAVE_BENEFICIARIO = ?1\r\n"
			+ ") WHERE linha BETWEEN ?2 AND (?2 + 10)", nativeQuery = true)
	public List<Pedido> getPedidosByBeneficiario(Long chaveBeneficiario, Long offset);
	
	@Query(value = "SELECT * FROM (\r\n"
			+ "  SELECT row_number() OVER (ORDER BY tp.DT_PEDIDO DESC) linha, tp.* FROM TAB_PEDIDO tp \r\n"
			+ "  INNER JOIN VW_BENEFICIARIO vb ON vb.CHAVE_BENEFICIARIO = tp.CHAVE_BENEFICIARIO \r\n"
			+ "  WHERE vb.CHAVE_FAMILIA = ?1\r\n"
			+ ") WHERE linha BETWEEN ?2 AND (?2 + 10)", nativeQuery = true)
	public List<Pedido> getPedidosByFamilia(Long chaveFamilia, Long offset);
}
