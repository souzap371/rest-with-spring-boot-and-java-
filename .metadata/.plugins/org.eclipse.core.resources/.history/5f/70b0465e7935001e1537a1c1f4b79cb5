package br.ufrn.imd.solicitacaurn.solus.repository;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import br.com.mkapi.solus.domain.Boleto;

public interface BoletoSolusRepository extends JpaRepository<Boleto, Long> {
	@Query(value=
	"SELECT CONCAT(mes, CONCAT('/',ano)) FROM " +
		"(SELECT DISTINCT " +
		"EXTRACT(MONTH FROM VENCIMENTO) mes, EXTRACT(YEAR FROM VENCIMENTO) ano " +
		"FROM VW_BOLETO " +
		"WHERE CHAVE_BENEFICIARIO = ?1 AND SITUACAO = 'paga' " +
		"ORDER BY ano, mes)", nativeQuery = true)
	public List<String> getOptionsByBeneficiario(Long chaveBeneficiario);


	@Query(value="SELECT * FROM VW_BOLETO WHERE CHAVE_BENEFICIARIO = ?1 AND SITUACAO != 'paga'", nativeQuery = true)
	public List<Boleto> getByBeneficiario(Long chaveBeneficiario);

	@Query(value="SELECT * FROM (SELECT * FROM VW_BOLETO " +
		"WHERE CHAVE_BENEFICIARIO = ?1 AND SITUACAO = 'paga') " +
		"WHERE VENCIMENTO >= TO_DATE(?2, 'MM/YYYY') " +
		"AND VENCIMENTO < ADD_MONTHS(TO_DATE(?3, 'MM/YYYY'), 1)", nativeQuery = true)
	public List<Boleto> getByBeneficiarioAndData(Long chaveBeneficiario, String dataInicio, String dataFim);
}
